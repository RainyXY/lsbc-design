## 升级指南：

## 1、引入修改：

示例：

```js
import { UploadService } from 'lsbc-design/dist/service';
// 改为：
import { UploadService } from 'lsbc-design/src/lib/service';
```

## 2、创建服务的方式修改

示例：

```js
Vue.prototype.$uploadService = new UploadService(() => {
  return store.getters.getToken;
}, '/material');
// 改为：
Vue.prototype.$uploadService = new UploadService(axios); // axios是你的axios实例，如：import axios from './api/newAxiosProxy'
```



#### 关于提供的axios的特别说明：

说明1，合法的axios类型 应当做3件事：

1. 拦截请求 对请求头添加用户token；
2. 识别后台请求，以便服务器能够将请求代理到后台服务器；
3. 对响应数据做剥离处理。完整的请求响应大致是这样的：{status：200，data:{code:0,data:any,msg:''},message:"OK"} 那么：剥离一层返回：{code:0,data:any,msg:''} 剥离两层返回的直接是 data指明的any，你应当对数据剥离一层或两层。

以上三点不满足将报错。（基本上大家封装的axios 这三点都会满足，可以忽略）



说明2，你传入的必须是一个import('axios').axiosInstance 的类型 。比如：

```js
const _axios = axios.create({
    //...
})
// 这个_axios就是合法的
```

如果要对_axios做代理，请参考下面：

```js
// 下面是对 _axios做了错误的代理，导致类型不再是axiosInstance：                     
const axios = function (data, handleError = false) {
return new Promise((resolve, reject) => {
    _axios(data).catch(err => {
        // ....
    });
});

// 正确代理建议是通过Proxy，能保证axios仍然是axiosInstance类型
const axios = new Proxy(_axios, {
    apply: function (fn, _this, args) {
        let res = fn.call(_this, ...args)
        if (res instanceof Promise) {
            res.catch(err => {
                // ....
            })
        }
        return res;
    }
})
```

## 3、方法调用的修改：

提供的方法由原来的四个变成了2个：

```js
// 单个上传比较简单，去掉了后台引入的 mediaType（1，图片，2 音频，3.....)
uploadOne(file,mediaType) 改为  uploadOne(file,false,progressFn?)
uploadPrivateOne(file,mediaType) 改为 uploadOne(file,true?,progressFn?)

// multiple上传 也删除后台引入的mediaType 
uploadMutiple(lines,mediaType,handleFn?)  改为：uploadMutiple(files,false,successFn?,progressFn?)
uploadPrivateMutiple(lines,mediaType,handleFn?)  改为：uploadMutiple(files,true?,successFn?,progressFn?)
                                                                  
// multiple 上传还有一些额外的修改：                                                               
//   lines 以前是一个拥有 {file:File } 字段的对象组成的数组，现在直接改成了 File[]
//   以前上传成功后，会设置每个line的url和key，同时清空file，现在没有任何操作了
//   关于multiple上传修改示例：
await vue.prototype.$uploadService.uploadPrivateMutiple(uploadLines, MEDIA_TYPE);
// 上面的原方法 等价于 下面的：
await vue.prototype.$uploadService.uploadMutiple(uploadLines.map(ele=>ele.file),false,({key,url},ind)=>{
    // 如果需要处理file，url，key的话：
    uploadLines[ind].file = undefined
    uploadLines[ind].key = key
    uploadLines[ind].url = url
})
```

